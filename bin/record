#!/bin/bash

# Delay before starting
DELAY=2

# Duration and output file
tmp=$(mktemp)
if [ -z "$1" ] ; then
    D=30
else 
    D=$1
fi

IFS=" " read -ra RECTANGLE <<< "$(slop --highlight --color=0.3,0.4,0.6,0.4 -f "%x %y %w %h")" || exit -1
# delay for recording
for (( i=$DELAY; i>0; --i )) ; do
    notify-send -u "low" -t 1010 "Recording in ... $i"
    sleep 1
done

if [ -z "$1" ] ; then
    byzanz-record --verbose -c --delay=0 -x ${RECTANGLE[0]} -y ${RECTANGLE[1]} -w ${RECTANGLE[2]} -h ${RECTANGLE[3]} --duration=$D --exec='dunstify -A "stopAction,stop" "Click here to stop recording!"' $tmp
else
    notify-send -t 500 "Recording for $D seconds"
    byzanz-record --verbose -c --delay=0 -x ${RECTANGLE[0]} -y ${RECTANGLE[1]} -w ${RECTANGLE[2]} -h ${RECTANGLE[3]} --duration=$D $tmp
fi

notify-send -t 1010 "Recording finished!"
# upload and save url to clipboard
curl -F"file=@$tmp" http://0x0.st | xclip -sel c
if [ -e "$tmp" ] ; then
    rm -f $tmp
fi
