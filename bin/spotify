#!/usr/bin/env python
from gi.repository import Playerctl, GLib

manager = Playerctl.PlayerManager()


def on_play(player, status, manager):
    print('player is playing: {}'.format(player.props.player_name))

def on_metadata(player, metadata, manager):
	keys = metadata.keys()
	if 'xesam:artist' in keys and 'xesam:title' in keys:
		print('{} - {}'.format(metadata['xesam:artist'][0], metadata['xesam:title']))

def init_player(name):
	if name.name in ['spotify']:
		player = Playerctl.Player.new_from_name(name)
        player.connect('metadata', on_metadata, manager)
        manager.manage_player(player)

def on_name_appeared(manager, name):
	init_player(name)

manager.connect('name-appeared', on_name_appeared)

for name in manager.props.player_names:
	init_player(name)

main = GLib.MainLoop()
main.run()